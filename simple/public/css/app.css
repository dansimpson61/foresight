/*
 Tokens (Tufte-aligned, joyful minimalism)
 - Purpose: A tiny, portable design system favoring clarity over chrome.
 - Scales:
	 * Type: --fs-12,14,16,20,24,32 (modular ~1.25–1.333). h1–h3 map to 32/24/20.
	 * Spacing: --sp-4,8,12,16,24,32 on a 4pt grid; compose with utilities (.stack/.cluster).
	 * Color: ink (text grays), paper (background grays), accent (accessible blue), muted; borders via --border.
	 * Radius/Shadows: --radius-1 (4px), --radius-2 (8px); --shadow-1 very subtle.
	 * Measure: --line-max ~80ch (readability).
 - Utilities:
	 * Layout: .stack (vertical rhythm), .cluster (row with wrap+gap), .right (align), .pad/.pad-lg, .border, .fill-50
	 * A11y: .sr-only for visually-hidden labels, .hidden for toggling display.
 - Extending safely:
	 1) Add new tokens as variables (e.g., --fs-40, --sp-40) near existing scales; do not inline magic numbers.
	 2) Prefer adjusting tokens or utilities rather than per-component overrides.
	 3) Keep chroma restrained; use accent sparingly for action/links/focus only.
	 4) Respect print: avoid heavy backgrounds; rely on borders and whitespace.
*/
/* Tufte-aligned minimal tokens */
:root {
	/* Ink & paper */
	--ink-900: #111; --ink-700: #333; --ink-500: #555; --muted: #6b7280;
	--paper-0: #ffffff; --paper-50: #f8fafc; --paper-100: #f1f5f9;
	/* Accent (accessible blue), success, warn, danger */
	--accent-700: #1558d6; --accent-600: #1d4ed8; --accent-500: #2563eb;
	--success-600: #16a34a; --warn-600: #b45309; --danger-600: #b91c1c;
	/* Borders & dividers */
	--border: #e5e7eb;
	/* Type scale */
	--fs-12: 0.75rem; --fs-14: 0.875rem; --fs-16: 1rem; --fs-20: 1.25rem; --fs-24: 1.5rem; --fs-32: 2rem;
	/* Spacing scale (4pt grid) */
	--sp-4: .25rem; --sp-8: .5rem; --sp-12: .75rem; --sp-16: 1rem; --sp-24: 1.5rem; --sp-32: 2rem;
	/* Radius & shadows (subtle) */
	--radius-1: 4px; --radius-2: 8px; --shadow-1: 0 1px 2px rgba(0,0,0,.04);
	/* Measure */
	--line-max: 80ch;
	/* TogglePanel animation duration */
	--tp-duration: 200ms;
	color-scheme: light dark;
}

/* Base */
html { font: 400 16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif; color: var(--ink-900); background: var(--paper-0); }

/* Grid layout for natural panel flow */
body { 
  display: grid;
  grid-template-areas: 
    "top top top"
    "left main right"
    "bottom bottom bottom";
  grid-template-rows: auto 1fr auto;
  grid-template-columns: auto 1fr auto;
  min-height: 100vh;
  margin: 0;
}

/* Panels flow naturally in their grid areas */
.toggle-panel[data-toggle-panel-position-value="left"] { grid-area: left; }
.toggle-panel[data-toggle-panel-position-value="right"] { grid-area: right; }
.toggle-panel[data-toggle-panel-position-value="top"] { grid-area: top; }
.toggle-panel[data-toggle-panel-position-value="bottom"] { grid-area: bottom; }

/* Page container takes main grid area */
.page-container { 
  grid-area: main;
  max-width: 1200px;
  margin: 0 auto;
  padding: var(--sp-24) var(--sp-16);
  width: 100%;
  overflow: auto;
}

/* Page structure */
header { margin-bottom: var(--sp-24); }
main { margin-bottom: var(--sp-32); }

h1, h2, h3 { color: var(--ink-900); }
h1 { font-size: var(--fs-32); line-height: 1.2; margin: 0 0 var(--sp-16); }
h2 { font-size: var(--fs-24); line-height: 1.25; margin: var(--sp-24) 0 var(--sp-8); }
h3 { font-size: var(--fs-20); line-height: 1.3; margin: var(--sp-16) 0 var(--sp-4); }
small { font-size: var(--fs-12); color: var(--muted); }
a { color: var(--accent-600); text-underline-offset: 2px; }
a:focus-visible,button:focus-visible,input:focus-visible,select:focus-visible,textarea:focus-visible { outline: 2px solid var(--accent-700); outline-offset: 2px; }
hr { border: none; border-top: 1px solid var(--border); margin: var(--sp-24) 0; }

.results-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem; }
@media (max-width: 800px) {
	.results-grid { grid-template-columns: 1fr; }
}

.strategy-card { padding: 1.5rem; border: 1px solid var(--border); border-radius: var(--radius-2); background-color: #fff; box-shadow: var(--shadow-1); }
.strategy-card h2 { margin-top: 0; }
.metric { margin-bottom: 0.5rem; }
.metric-label { font-weight: bold; }

#chart-container { width: 100%; height: 400px; position: relative; }

.data-table { width: 100%; border-collapse: collapse; margin-top: 1rem; font-size: 0.9rem; }
.data-table th, .data-table td { border: 1px solid var(--border); padding: 0.5rem; text-align: right; }
.data-table th { background-color: var(--paper-100); font-weight: bold; }

.editor-section { margin-bottom: 2rem; }
.editor-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
.editor-header { cursor: pointer; }
.editor-header:hover { background-color: var(--paper-50); }
.editor-form { padding: 1.5rem; border: 1px solid var(--border); border-radius: var(--radius-2); background-color: var(--paper-50); }
/* Hide the form when the <details> element is not open */
details:not([open]) > .editor-form { display: none; }

.form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; }
.form-section { margin-bottom: 2rem; }
.form-section:last-child { margin-bottom: 0; }
.form-section h3 { margin-top: 0; margin-bottom: 1rem; font-size: 1.1rem; color: var(--ink-700); border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; }

.form-group { display: flex; flex-direction: column; }
.form-group label { font-weight: 600; margin-bottom: 0.5rem; font-size: 0.9rem; color: var(--ink-700); }
.form-group input, .form-group select { padding: 0.6rem; border: 1px solid #ccc; border-radius: 4px; font-size: 0.95rem; }
.form-group input:focus, .form-group select:focus { outline: none; border-color: var(--accent-600); box-shadow: 0 0 0 2px rgba(29,78,216,0.15); }
.form-help { font-size: 0.8rem; color: #6b7280; margin-top: 0.25rem; }

.button { background-color: var(--accent-600); color: white; padding: 0.6rem 1rem; border: 1px solid transparent; border-radius: var(--radius-1); cursor: pointer; font-size: 1rem; }
.button:hover { background-color: var(--accent-700); }
.button.secondary { background-color: #6b7280; }
.button.secondary:hover { background-color: #4b5563; }
.button.danger { background-color: var(--danger-600); }
.button.danger:hover { filter: brightness(0.9); }
.button:disabled { opacity: 0.6; cursor: not-allowed; }

.limitation-note { background-color: #fef3c7; border-left: 4px solid #f59e0b; padding: 1rem; margin: 1rem 0; border-radius: 4px; font-size: 0.9rem; }
.limitation-note strong { color: #92400e; }

.account-entry, .income-entry { border-top: 1px solid #eee; padding-top: 1rem; margin-top: 1rem; }
.account-entry:first-child, .income-entry:first-child { border-top: none; padding-top: 0; margin-top: 0; }
.account-entry h4, .income-entry h4 { font-size: 1rem; margin-bottom: 1rem; color: #666; }

.accordion-header { cursor: pointer; padding: 1rem; background-color: #f8f8f8; border: 1px solid var(--border); border-radius: var(--radius-1); margin-top: 1rem; font-weight: 600; }
.accordion-header:hover, details[open] > summary.accordion-header { background-color: #f0f0f0; }
.accordion-panel__content { padding: 1.5rem; border: 1px solid var(--border); border-top: none; border-radius: 0 0 var(--radius-1) var(--radius-1); }

/* Native <details> accordion styling */
details.accordion-panel { margin-top: 1rem; }
details.accordion-panel > summary { list-style: none; /* Hide default marker */ }
details.accordion-panel > summary::-webkit-details-marker { display: none; /* Hide default marker for Safari */ }

.viz-badge { margin-left: 0.5rem; padding: 0.15rem 0.5rem; background: #eef2ff; color: #3730a3; border-radius: var(--radius-1); font-size: 0.8rem; }

#net-worth-chart-container { width: 100%; height: 400px; position: relative; }

/* Toggle Panel: CSS-driven hover-open with sticky click, grid-flow layout */
.toggle-panel {
	--tp-collapsed-size-v: 2.75rem;           /* default width when vertical (left/right) */
	--tp-expanded-size-v: min(360px, 85vw);    /* default width when vertical */
	--tp-collapsed-size-h: 2.25rem;            /* default height when horizontal (top/bottom) */
	--tp-expanded-size-h: min(40vh, 480px);    /* default height when horizontal */
	background: var(--paper-50);
	border: 1px solid var(--border);
	box-shadow: var(--shadow-1);
	display: flex;
	overflow: hidden;
	z-index: 30;
	transition: width var(--tp-duration, 200ms) ease, height var(--tp-duration, 200ms) ease;
	/* Natural flow in grid - no fixed positioning needed */
	position: relative;
}
.toggle-panel.is-vertical { width: var(--tp-collapsed-size-v); }
.toggle-panel.is-horizontal { height: var(--tp-collapsed-size-h); }
/* Open on hover or when sticky */
.toggle-panel.is-vertical:hover,
.toggle-panel.is-vertical.is-sticky { width: var(--tp-expanded-size-v); }
.toggle-panel.is-horizontal:hover,
.toggle-panel.is-horizontal.is-sticky { height: var(--tp-expanded-size-h); }
.toggle-panel__content { padding: var(--sp-12); overflow: auto; flex: 1 1 auto; }
.toggle-panel__handle { position: absolute; background: #fff; border: none; border-radius: var(--radius-1); padding: .35rem .55rem; cursor: pointer; color: var(--ink-700); }
/* Upper-left label, elegant and visible even when collapsed */
.toggle-panel__label { position: absolute; top: .35rem; left: .5rem; font-size: var(--fs-12); color: var(--muted); pointer-events: none; display: inline-flex; align-items: center; gap: .35rem; }
.toggle-panel__icon { display: inline-block; line-height: 1; }

/* Vertical panels: show only icons when collapsed, text when expanded */
.toggle-panel.is-vertical:not(:hover):not(.is-sticky) .toggle-panel__text { display: none; }

/* Hide content when collapsed (only label/handle visible) */
.toggle-panel:not(.is-sticky):not(:hover) .toggle-panel__content { display: none; }
/* Nested panels should sit above parent content */
.toggle-panel .toggle-panel { z-index: 40; }
.toggle-panel .toggle-panel.is-horizontal { background: #fff; border-color: var(--border); }
/* Handle placement for edges */
.toggle-panel[data-toggle-panel-position-value="left"] .toggle-panel__handle { right: .5rem; top: .5rem; }
.toggle-panel[data-toggle-panel-position-value="right"] .toggle-panel__handle { left: .5rem; top: .5rem; }
.toggle-panel[data-toggle-panel-position-value="top"] .toggle-panel__handle { right: .5rem; bottom: .5rem; }
.toggle-panel[data-toggle-panel-position-value="bottom"] .toggle-panel__handle { right: .5rem; top: .5rem; }

/* Utilities */
.stack > * + * { margin-top: var(--sp-8); }
.stack-lg > * + * { margin-top: var(--sp-16); }
.cluster { display: flex; flex-wrap: wrap; gap: var(--sp-8); align-items: center; }
.right { text-align: right; }
.muted { color: var(--muted); }
.pad { padding: var(--sp-12); }
.pad-lg { padding: var(--sp-24); }
.border { border: 1px solid var(--border); border-radius: var(--radius-1); }
.fill-50 { background: var(--paper-50); }
.hidden { display: none !important; }
.sr-only { position: absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

/* Dev-only link (visible when ?dev=1 renders it) */
.dev-link { font-size: var(--fs-12); color: var(--muted); text-decoration: none; }
.dev-link:hover { text-decoration: underline; color: var(--ink-700); }

/* Print: remove color noise and ensure borders visible */
@media print {
	a { text-decoration: none; color: black; }
	.button, .toggle { display: none !important; }
	.strategy-card { box-shadow: none; border-color: #000; }
	.data-table th, .data-table td { border-color: #000; }
}
